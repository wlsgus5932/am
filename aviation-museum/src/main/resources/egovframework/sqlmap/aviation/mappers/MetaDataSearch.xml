<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.aviation.metadata.service.impl.MetaDataSearchMapper">

    <select id="getMetaDataSearchList" parameterType="egovframework.aviation.metadata.vo.MetaDataSearchVO" resultType="egovframework.aviation.metadata.vo.MetaDataSearchVO">
           SELECT R1.* FROM( 
	             select 
					 row_number() over(order by nib.REG_DATE desc) as rnum	
					,nib.ITEM_IDX 
					,lag(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as PREV
					,lead(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as NEXT
					,(SELECT ni.IMAGE_IDX from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_IDX 
					,(SELECT ni.IMAGE_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_NM
					,(SELECT ni.THUMBNAIL_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as THUMBNAIL_NM
					,(SELECT ni.IMAGE_PATH from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_PATH 
					,nib.ORG_CODE_IDX 
					,nib.POSSESSION_CODE_IDX
					,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
					,nib.ITEM_NO 
					,nib.ITEM_DETAIL_NO 
					,nib.ITEM_NM 
					,nib.ITEM_SE_NM 
					,nib.ITEM_ENG_NM 
					,nib.AUTHOR 
					,nib.QTY 
					,nib.QTY_UNIT_CODE_IDX 
					,nib.ICAO_CODE_IDX 
					,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
					,nib.EXISTENCE_CODE_IDX 
					,nib.MANAGEMENT_NO 
					,nib.PRESERVATION_NEED 
					,nib.FEATURE 
					,nib.CONDITION_CODE_IDX 
					,nib.RANKING_CODE_IDX 
					,nib.REMARK 
					,nib.REG_STATE 
					,nib.REG_USER 
					,nib.REG_DATE 
					,nib.MOD_USER 
					,nib.MOD_DATE 
					,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
					,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
					,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = nib.item_idx limit 1)) as COUNTRY_NM
					,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = nib.item_idx ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
					,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = nib.item_idx limit 1) as MEASUREMENT_VALUE
					,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS1_NM
					,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS2_NM
					,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS3_NM
					,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
				from nam_item_base nib
				LEFT join nam_country_era nce2 
				on nib.ITEM_IDX = nce2.ITEM_IDX
				LEFT join nam_material nm3 
				on nib.ITEM_IDX = nm3.ITEM_IDX 
				left join nam_keyword nk 
				on nib.ITEM_IDX = nk.ITEM_IDX 				
				WHERE 1=1
				AND REG_STATE = #{reg_state}
				<if test=" '' != research_word and null != research_word">		
					<if test=" '' != searched_word and null != searched_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{searched_word}, '%')) 
					</if>	
				</if>
				<if test=" '' != search_word and null != search_word">
					AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{search_word}, '%')) 
				</if>
				<if test=" '' != detail_search_word1 and null != detail_search_word1">
					<if test="search_type == 'item_nm'">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_se_nm'">
						AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_eng_nm'">
						AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'keyword'">
						AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>					
					<if test="search_type == '' or search_type == null">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%')) 
					</if>
				</if>
				<if test=" '' != detail_search_word2 and null != detail_search_word2">
					<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
						<if test="search_type2 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>								
						<if test="search_type2 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr1 == 'OR'">
						<if test="search_type2 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>								
						<if test="search_type2 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != detail_search_word3 and null != detail_search_word3">
					<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
						<if test="search_type3 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>								
						<if test="search_type3 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr2 == 'OR'">
						<if test="search_type3 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != search_range and null != search_range">
					AND nib.POSSESSION_CODE_IDX = #{search_range}
				</if>
	            <if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
	                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
	            </if>
	            <if test="country != null and country.size != 0">
					AND nce2.COUNTRY_CODE_IDX IN
					<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
						#{country_seq}
					</foreach>
				</if>
				<if test="material1 != null and material1.size != 0">
					AND nm3.MATERIAL1_CODE_IDX IN
					<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
						#{material1_seq}
					</foreach>
				</if>
				GROUP BY item_idx
				ORDER BY rnum
            ) R1
            WHERE 1=1
           	<if test=" '' != item_idx and null != item_idx">
				AND ITEM_IDX = #{item_idx}
			</if>

            LIMIT #{perPageNum} OFFSET #{pageStart}  
	</select>
	
	<select id="getMetaDataSearchListCnt" resultType="Integer">
           SELECT 
          		 count(*)  
           FROM( 
	             select 
					 row_number() over(order by nib.REG_DATE desc) as rnum	
					,nib.ITEM_IDX 
					,lag(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as PREV
					,lead(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as NEXT
					,(SELECT ni.IMAGE_IDX from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_IDX 
					,(SELECT ni.IMAGE_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_NM
					,(SELECT ni.THUMBNAIL_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as THUMBNAIL_NM
					,(SELECT ni.IMAGE_PATH from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_PATH 
					,nib.ORG_CODE_IDX 
					,nib.POSSESSION_CODE_IDX
					,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
					,nib.ITEM_NO 
					,nib.ITEM_DETAIL_NO 
					,nib.ITEM_NM 
					,nib.ITEM_SE_NM 
					,nib.ITEM_ENG_NM 
					,nib.AUTHOR 
					,nib.QTY 
					,nib.QTY_UNIT_CODE_IDX 
					,nib.ICAO_CODE_IDX 
					,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
					,nib.EXISTENCE_CODE_IDX 
					,nib.MANAGEMENT_NO 
					,nib.PRESERVATION_NEED 
					,nib.FEATURE 
					,nib.CONDITION_CODE_IDX 
					,nib.RANKING_CODE_IDX 
					,nib.REMARK 
					,nib.REG_STATE 
					,nib.REG_USER 
					,nib.REG_DATE 
					,nib.MOD_USER 
					,nib.MOD_DATE 
					,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
					,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
					,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = nib.item_idx limit 1)) as COUNTRY_NM
					,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = nib.item_idx ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
					,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = nib.item_idx limit 1) as MEASUREMENT_VALUE
					,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS1_NM
					,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS2_NM
					,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS3_NM
					,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
				from nam_item_base nib
				LEFT join nam_country_era nce2 
				on nib.ITEM_IDX = nce2.ITEM_IDX
				LEFT join nam_material nm3 
				on nib.ITEM_IDX = nm3.ITEM_IDX 
				left join nam_keyword nk 
				on nib.ITEM_IDX = nk.ITEM_IDX 					
				WHERE 1=1
				AND REG_STATE = #{reg_state}
				<if test=" '' != research_word and null != research_word">		
					<if test=" '' != searched_word and null != searched_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{searched_word}, '%')) 
					</if>	
				</if>
				<if test=" '' != search_word and null != search_word">
					AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{search_word}, '%')) 
				</if>
				<if test=" '' != detail_search_word1 and null != detail_search_word1">
					<if test="search_type == 'item_nm'">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_se_nm'">
						AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_eng_nm'">
						AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'keyword'">
						AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>							
					<if test="search_type == '' or search_type == null">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%')) 
					</if>
				</if>
				<if test=" '' != detail_search_word2 and null != detail_search_word2">
					<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
						<if test="search_type2 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>								
						<if test="search_type2 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr1 == 'OR'">
						<if test="search_type2 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>								
						<if test="search_type2 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != detail_search_word3 and null != detail_search_word3">
					<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
						<if test="search_type3 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>								
						<if test="search_type3 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr2 == 'OR'">
						<if test="search_type3 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>								
						<if test="search_type3 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != search_range and null != search_range">
					AND nib.POSSESSION_CODE_IDX = #{search_range}
				</if>
				<if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
	                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
	            </if>
	            <if test="country != null and country.size != 0">
					AND nce2.COUNTRY_CODE_IDX IN
					<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
						#{country_seq}
					</foreach>
				</if>
				<if test="material1 != null and material1.size != 0">
					AND nm3.MATERIAL1_CODE_IDX IN
					<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
						#{material1_seq}
					</foreach>
				</if>
				GROUP BY item_idx
				ORDER BY rnum
            ) R1

	</select>
	
	 <select id="getMetaDataSearchListCurrentQty" parameterType="egovframework.aviation.metadata.vo.MetaDataSearchVO" resultType="egovframework.aviation.metadata.vo.MetaDataSearchVO">
           SELECT R1.* FROM( 
	             select 
					 row_number() over(order by nib.REG_DATE desc) as rnum	
					,nib.ITEM_IDX 
					,lag(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as PREV
					,lead(nib.ITEM_IDX, 1) over (order by REG_DATE DESC) as NEXT
					,(SELECT ni.IMAGE_IDX from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_IDX 
					,(SELECT ni.IMAGE_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_NM
					,(SELECT ni.THUMBNAIL_NM from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as THUMBNAIL_NM
					,(SELECT ni.IMAGE_PATH from nam_image ni WHERE ni.ITEM_IDX = nib.ITEM_IDX AND REP_IMAGE = 'Y' limit 1) as IMAGE_PATH 
					,nib.ORG_CODE_IDX 
					,nib.POSSESSION_CODE_IDX
					,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
					,nib.ITEM_NO 
					,nib.ITEM_DETAIL_NO 
					,nib.ITEM_NM 
					,nib.ITEM_SE_NM 
					,nib.ITEM_ENG_NM 
					,nib.AUTHOR 
					,nib.QTY 
					,nib.QTY_UNIT_CODE_IDX 
					,nib.ICAO_CODE_IDX 
					,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
					,nib.EXISTENCE_CODE_IDX 
					,nib.MANAGEMENT_NO 
					,nib.PRESERVATION_NEED 
					,nib.FEATURE 
					,nib.CONDITION_CODE_IDX 
					,nib.RANKING_CODE_IDX 
					,nib.REMARK 
					,nib.REG_STATE 
					,nib.REG_USER 
					,nib.REG_DATE 
					,nib.MOD_USER 
					,nib.MOD_DATE 
					,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
					,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
					,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = nib.item_idx limit 1)) as COUNTRY_NM
					,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = nib.item_idx ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
					,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = nib.item_idx limit 1) as MEASUREMENT_VALUE
					,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS1_NM
					,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS2_NM
					,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = nib.item_idx limit 1) as CLASS3_NM
					,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
				from nam_item_base nib
				LEFT join nam_country_era nce2 
				on nib.ITEM_IDX = nce2.ITEM_IDX
				LEFT join nam_material nm3 
				on nib.ITEM_IDX = nm3.ITEM_IDX 
				left join nam_keyword nk 
				on nib.ITEM_IDX = nk.ITEM_IDX 	
				WHERE 1=1
				AND REG_STATE = #{reg_state}
				<if test=" '' != research_word and null != research_word">		
					<if test=" '' != searched_word and null != searched_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{searched_word}, '%')) 
					</if>	
				</if>
				<if test=" '' != search_word and null != search_word">
					AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{search_word}, '%')) 
				</if>
				<if test=" '' != detail_search_word1 and null != detail_search_word1">
					<if test="search_type == 'item_nm'">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_se_nm'">
						AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_eng_nm'">
						AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'keyword'">
						AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>							
					<if test="search_type == '' or search_type == null">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word1}, '%')) 
					</if>
				</if>
				<if test=" '' != detail_search_word2 and null != detail_search_word2">
					<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
						<if test="search_type2 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>		
						<if test="search_type2 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr1 == 'OR'">
						<if test="search_type2 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>		
						<if test="search_type2 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != detail_search_word3 and null != detail_search_word3">
					<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
						<if test="search_type3 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>								
						<if test="search_type3 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr2 == 'OR'">
						<if test="search_type3 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>								
						<if test="search_type3 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.KEYWORD LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != search_range and null != search_range">
					AND nib.POSSESSION_CODE_IDX = #{search_range}
				</if>
	            <if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
	                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
	            </if>
	            <if test="country != null and country.size != 0">
					AND nce2.COUNTRY_CODE_IDX IN
					<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
						#{country_seq}
					</foreach>
				</if>
				<if test="material1 != null and material1.size != 0">
					AND nm3.MATERIAL1_CODE_IDX IN
					<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
						#{material1_seq}
					</foreach>
				</if>
				GROUP BY item_idx
				ORDER BY rnum
            ) R1
            WHERE 1=1
           	<if test=" '' != item_idx and null != item_idx">
				AND ITEM_IDX = #{item_idx}
			</if>

	</select>
	
	
    <select id="getMetaDataSearchImageList" parameterType="egovframework.aviation.metadata.vo.MetaDataSearchImageVO" resultType="egovframework.aviation.metadata.vo.MetaDataSearchImageVO">
           SELECT R1.* FROM( 
		           SELECT 
		   				 ni.*
						,row_number() over(order by REG_DATE DESC, IMAGE_IDX) as rnum
						,lag(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as PREV
						,lead(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as NEXT
						,nib.ITEM_NO 
						,nib.ITEM_DETAIL_NO 
						,nib.ITEM_NM 
						,nib.ITEM_SE_NM 
						,nib.ITEM_ENG_NM 
						,nib.AUTHOR 
						,nib.QTY 
						,nib.QTY_UNIT_CODE_IDX 
						,nib.ICAO_CODE_IDX 
						,nib.ORG_CODE_IDX 
						,nib.POSSESSION_CODE_IDX 
						,nib.REG_STATE 
						,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
						,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
						,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
						,(SELECT nit.TAG_NM from nam_image_tag nit WHERE nit.IMAGE_IDX = ni.IMAGE_IDX) as TAG_NM
						,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
						,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = ni.ITEM_IDX limit 1)) as COUNTRY_NM
						,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = ni.ITEM_IDX ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
						,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = ni.ITEM_IDX limit 1) as MEASUREMENT_VALUE
						,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS1_NM
						,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS2_NM
						,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS3_NM
						,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
					FROM 
						nam_image ni
					left join nam_item_base nib 
					on ni.ITEM_IDX = nib.ITEM_IDX 
					left join nam_country_era nce2 
					on nib.ITEM_IDX = nce2.ITEM_IDX
					left join nam_material nm3 
					on nib.ITEM_IDX = nm3.ITEM_IDX 
					left join nam_keyword nk 
					on nib.ITEM_IDX = nk.ITEM_IDX 
					WHERE 1=1
					AND nib.REG_STATE = #{reg_state}
					<if test=" '' != research_word and null != research_word">		
						<if test=" '' != searched_word and null != searched_word">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.keyword LIKE CONCAT('%', #{searched_word}, '%')) 
						</if>	
					</if>
					<if test=" '' != search_word and null != search_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.keyword LIKE CONCAT('%', #{search_word}, '%')) 
					</if>
					<if test=" '' != detail_search_word1 and null != detail_search_word1">
						<if test="search_type == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%')) 
						</if>
					</if>
					<if test=" '' != detail_search_word2 and null != detail_search_word2">
						<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
							<if test="search_type2 == 'item_nm'">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_se_nm'">
								AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_eng_nm'">
								AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								AND (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>	
							<if test="search_type2 == '' or search_type == null">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
							</if>
						</if>
						<if test="pSrchfAndOr1 == 'OR'">
							<if test="search_type2 == 'item_nm'">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_se_nm'">
								OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_eng_nm'">
								OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								OR (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == '' or search_type == null">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
							</if>
						</if>
					</if>
					<if test=" '' != detail_search_word3 and null != detail_search_word3">
						<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
							<if test="search_type3 == 'item_nm'">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_se_nm'">
								AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_eng_nm'">
								AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								AND (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == '' or search_type == null">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
							</if>
						</if>
						<if test="pSrchfAndOr2 == 'OR'">
							<if test="search_type3 == 'item_nm'">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_se_nm'">
								OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_eng_nm'">
								OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								OR (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == '' or search_type == null">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
							</if>
						</if>
					</if>
					<if test=" '' != search_range and null != search_range">
						AND nib.POSSESSION_CODE_IDX = #{search_range}
					</if>
					<if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
		                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
		            </if>
		            <if test="country != null and country.size != 0">
						AND nce2.COUNTRY_CODE_IDX IN
						<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
							#{country_seq}
						</foreach>
					</if>
					<if test="material1 != null and material1.size != 0">
						AND nm3.MATERIAL1_CODE_IDX IN
						<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
							#{material1_seq}
						</foreach>
					</if>
					GROUP BY image_idx
					ORDER BY rnum
            ) R1
            <if test=" '' != image_idx and null != image_idx">
				WHERE IMAGE_IDX = #{image_idx}
			</if>
            LIMIT #{perPageNum} OFFSET #{pageStart}  
	</select>
	
	    <select id="getMetaDataSearchImageListCurrentQty" parameterType="egovframework.aviation.metadata.vo.MetaDataSearchImageVO" resultType="egovframework.aviation.metadata.vo.MetaDataSearchImageVO">
           SELECT R1.* FROM( 
		           SELECT 
		   				 ni.*
						,row_number() over(order by REG_DATE DESC, IMAGE_IDX) as rnum
						,lag(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as PREV
						,lead(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as NEXT
						,nib.ITEM_NO 
						,nib.ITEM_DETAIL_NO 
						,nib.ITEM_NM 
						,nib.ITEM_SE_NM 
						,nib.ITEM_ENG_NM 
						,nib.AUTHOR 
						,nib.QTY 
						,nib.QTY_UNIT_CODE_IDX 
						,nib.ICAO_CODE_IDX 
						,nib.ORG_CODE_IDX 
						,nib.POSSESSION_CODE_IDX 
						,nib.REG_STATE
						,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
						,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
						,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
						,(SELECT nit.TAG_NM from nam_image_tag nit WHERE nit.IMAGE_IDX = ni.IMAGE_IDX) as TAG_NM
						,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
						,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = ni.ITEM_IDX limit 1)) as COUNTRY_NM
						,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = ni.ITEM_IDX ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
						,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = ni.ITEM_IDX limit 1) as MEASUREMENT_VALUE
						,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS1_NM
						,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS2_NM
						,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS3_NM
						,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
					FROM 
						nam_image ni
					left join nam_item_base nib 
					on ni.ITEM_IDX = nib.ITEM_IDX 
					left join nam_country_era nce2 
					on nib.ITEM_IDX = nce2.ITEM_IDX
					left join nam_material nm3 
					on nib.ITEM_IDX = nm3.ITEM_IDX 
					left join nam_keyword nk 
					on nib.ITEM_IDX = nk.ITEM_IDX 
					WHERE 1=1
					AND nib.REG_STATE = #{reg_state}
					<if test=" '' != research_word and null != research_word">		
						<if test=" '' != searched_word and null != searched_word">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.keyword LIKE CONCAT('%', #{searched_word}, '%')) 
						</if>	
					</if>
					<if test=" '' != search_word and null != search_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.keyword LIKE CONCAT('%', #{search_word}, '%')) 
					</if>
					<if test=" '' != detail_search_word1 and null != detail_search_word1">
						<if test="search_type == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%'))
						</if>
						<if test="search_type == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%')) 
						</if>
					</if>
					<if test=" '' != detail_search_word2 and null != detail_search_word2">
						<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
							<if test="search_type2 == 'item_nm'">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_se_nm'">
								AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_eng_nm'">
								AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								AND (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == '' or search_type == null">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
							</if>
						</if>
						<if test="pSrchfAndOr1 == 'OR'">
							<if test="search_type2 == 'item_nm'">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_se_nm'">
								OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type2 == 'item_eng_nm'">
								OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								OR (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
							</if>							
							<if test="search_type2 == '' or search_type == null">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
							</if>
						</if>
					</if>
					<if test=" '' != detail_search_word3 and null != detail_search_word3">
						<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
							<if test="search_type3 == 'item_nm'">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_se_nm'">
								AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_eng_nm'">
								AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								AND (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == '' or search_type == null">
								AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
							</if>
						</if>
						<if test="pSrchfAndOr2 == 'OR'">
							<if test="search_type3 == 'item_nm'">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_se_nm'">
								OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == 'item_eng_nm'">
								OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type == 'keyword'">
								OR (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
							</if>
							<if test="search_type3 == '' or search_type == null">
								OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
							</if>
						</if>
					</if>
					<if test=" '' != search_range and null != search_range">
						AND nib.POSSESSION_CODE_IDX = #{search_range}
					</if>
					<if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
		                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
		            </if>
		            <if test="country != null and country.size != 0">
						AND nce2.COUNTRY_CODE_IDX IN
						<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
							#{country_seq}
						</foreach>
					</if>
					<if test="material1 != null and material1.size != 0">
						AND nm3.MATERIAL1_CODE_IDX IN
						<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
							#{material1_seq}
						</foreach>
					</if>
					GROUP BY image_idx
					ORDER BY rnum
            ) R1
            <if test=" '' != image_idx and null != image_idx">
				WHERE IMAGE_IDX = #{image_idx}
			</if>
	</select>
	
	<select id="getMetaDataSearchImageListCnt" resultType="Integer">
             SELECT
             	count(*) 
			 FROM( 
		           SELECT 
		   				 ni.*
						,row_number() over(order by REG_DATE DESC, IMAGE_IDX) as rnum
						,lag(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as PREV
						,lead(IMAGE_IDX, 1) over (order by REG_DATE DESC, IMAGE_IDX) as NEXT
						,nib.ITEM_NO 
						,nib.ITEM_DETAIL_NO 
						,nib.ITEM_NM 
						,nib.ITEM_SE_NM 
						,nib.ITEM_ENG_NM 
						,nib.AUTHOR 
						,nib.QTY 
						,nib.QTY_UNIT_CODE_IDX 
						,nib.ICAO_CODE_IDX 
						,nib.ORG_CODE_IDX 
						,nib.POSSESSION_CODE_IDX 
						,nib.REG_STATE
						,(SELECT nmc.MATERIAL1_CODE_IDX from nam_material1_code nmc WHERE nmc.MATERIAL1_CODE_IDX = (SELECT nm.MATERIAL1_CODE_IDX from nam_material nm WHERE nm.ITEM_IDX = nib.ITEM_IDX limit 1)) as MATERIAL1
						,(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce  WHERE nce.ITEM_IDX = nib.ITEM_IDX limit 1) as COUNTRY
						,(SELECT nic.ICAO_NM FROM nam_icao_code nic WHERE nic.ICAO_CODE_IDX = nib.ICAO_CODE_IDX) as ICAO_NM
						,(SELECT nit.TAG_NM from nam_image_tag nit WHERE nit.IMAGE_IDX = ni.IMAGE_IDX) as TAG_NM
						,(SELECT npc.POSSESSION_NM from nam_possession_code npc WHERE npc.POSSESSION_CODE_IDX = nib.POSSESSION_CODE_IDX) as POSSESSION_NM 
						,(SELECT ncc.COUNTRY_NM from nam_country_code ncc WHERE ncc.COUNTRY_CODE_IDX =(SELECT nce.COUNTRY_CODE_IDX from nam_country_era nce WHERE ITEM_IDX = ni.ITEM_IDX limit 1)) as COUNTRY_NM
						,(SELECT nsc.STORAGE_NM FROM nam_movement nm join nam_storage ns on nm.MOVEMENT_IDX = ns.MOVEMENT_IDX join nam_storage_code nsc on ns.STORAGE_CODE_IDX = nsc.STORAGE_CODE_IDX WHERE nm.ITEM_IDX = ni.ITEM_IDX ORDER by nm.MOVEMENT_DATE DESC , nm.REG_DATE DESC limit 1) as STORAGE_NM
						,(SELECT nm2.MEASUREMENT_VALUE FROM nam_measurement nm2 WHERE nm2.ITEM_IDX = ni.ITEM_IDX limit 1) as MEASUREMENT_VALUE
						,(SELECT ncc.CLASS1_NM from nam_taxonomy nt join nam_class1_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS1_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS1_NM
						,(SELECT ncc.CLASS2_NM from nam_taxonomy nt join nam_class2_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS2_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS2_NM
						,(SELECT ncc.CLASS3_NM from nam_taxonomy nt join nam_class3_code ncc on nt.CLASS1_CODE_IDX = ncc.CLASS3_CODE_IDX WHERE nt.item_idx = ni.ITEM_IDX limit 1) as CLASS3_NM
						,(SELECT a.CURRENT_QTY FROM nam_movement AS a INNER JOIN (SELECT ITEM_IDX, MAX(REG_DATE) AS REG_DATE FROM nam_movement GROUP BY ITEM_IDX) AS b ON a.REG_DATE = b.REG_DATE WHERE a.ITEM_IDX = b.ITEM_IDX AND a.ITEM_IDX = nib.ITEM_IDX) as CURRENT_QTY
					FROM 
						nam_image ni
					left join nam_item_base nib 
					on ni.ITEM_IDX = nib.ITEM_IDX 
					left join nam_country_era nce2 
					on nib.ITEM_IDX = nce2.ITEM_IDX
					left join nam_material nm3 
					on nib.ITEM_IDX = nm3.ITEM_IDX 
					left join nam_keyword nk 
					on nib.ITEM_IDX = nk.ITEM_IDX 
					WHERE 1=1
					AND nib.REG_STATE = #{reg_state}
				<if test=" '' != research_word and null != research_word">		
					<if test=" '' != searched_word and null != searched_word">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{searched_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{searched_word}, '%') OR nk.keyword LIKE CONCAT('%', #{searched_word}, '%')) 
					</if>	
				</if>
				<if test=" '' != search_word and null != search_word">
					AND (nib.ITEM_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{search_word}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{search_word}, '%') OR nk.keyword LIKE CONCAT('%', #{search_word}, '%')) 
				</if>
				<if test=" '' != detail_search_word1 and null != detail_search_word1">
					<if test="search_type == 'item_nm'">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_se_nm'">
						AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'item_eng_nm'">
						AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == 'keyword'">
						AND (nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%'))
					</if>
					<if test="search_type == '' or search_type == null">
						AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word1}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word1}, '%')) 
					</if>
				</if>
				<if test=" '' != detail_search_word2 and null != detail_search_word2">
					<if test="pSrchfAndOr1 == 'AND' or pSrchfAndOr1 == '' ">
						<if test="search_type2 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr1 == 'OR'">
						<if test="search_type2 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%'))
						</if>
						<if test="search_type2 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word2}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word2}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != detail_search_word3 and null != detail_search_word3">
					<if test="pSrchfAndOr2 == 'AND' or pSrchfAndOr2 == '' ">
						<if test="search_type3 == 'item_nm'">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							AND (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							AND (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							AND (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == '' or search_type == null">
							AND (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
					<if test="pSrchfAndOr2 == 'OR'">
						<if test="search_type3 == 'item_nm'">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_se_nm'">
							OR (nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == 'item_eng_nm'">
							OR (nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type == 'keyword'">
							OR (nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%'))
						</if>
						<if test="search_type3 == '' or search_type == null">
							OR (nib.ITEM_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_SE_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nib.ITEM_ENG_NM LIKE CONCAT('%', #{detail_search_word3}, '%') OR nk.keyword LIKE CONCAT('%', #{detail_search_word3}, '%')) 
						</if>
					</if>
				</if>
				<if test=" '' != search_range and null != search_range">
					AND nib.POSSESSION_CODE_IDX = #{search_range}
				</if>
				<if test="start_item_no != null and start_item_no != '' and end_item_no != null and end_item_no != ''">AND
	                (nib.item_no BETWEEN CONVERT(#{start_item_no}, SIGNED) and CONVERT(#{end_item_no}, SIGNED))
	            </if>
	            <if test="country != null and country.size != 0">
					AND nce2.COUNTRY_CODE_IDX IN
					<foreach collection="country" item="country_seq" open="(" close=")" separator=",">
						#{country_seq}
					</foreach>
				</if>
				<if test="material1 != null and material1.size != 0">
					AND nm3.MATERIAL1_CODE_IDX IN
					<foreach collection="material1" item="material1_seq" open="(" close=")" separator=",">
						#{material1_seq}
					</foreach>
				</if>
				GROUP BY image_idx
				ORDER BY rnum
            ) R1
	</select>
	
	<insert id="insertInterest" parameterType="egovframework.aviation.mypage.vo.InterestVO">
		   INSERT INTO nam_interest
                  ( ITEM_IDX
                  , EXPL
                  , REG_USER
                  , REG_DATE )
           VALUES ( #{item_idx}
                  , #{expl}
                  , #{reg_user}
                  , now())
    </insert>
    
    <select id="getKeywordList" resultType="egovframework.aviation.metadata.vo.KeywordVO">
		select 
			*, 
			row_number() over(order by reg_date) rownum 
		from 
			nam_keyword 
		where 
			item_idx = #{item_idx} 
		<if test="keyword != '' and keyword != null">
			and keyword = #{keyword}
		</if>
		order by rownum desc;
	</select>
	
	<insert id="addKeyword" parameterType="egovframework.aviation.metadata.vo.param.KeywordParamVO">
		   INSERT INTO nam_keyword_request
                  ( 
                 	keyword_list
                  , ITEM_IDX
                  , approval_state
                  , refusal_reason
                  , REG_USER
                  , REG_DATE 
                  )
           VALUES 
           ( 
                  	#{addKeyword}
           		  , #{item_idx}
                  , 'F'
                  ,  ''
                  , #{reg_user}
                  , now()
            )
    </insert>
</mapper>